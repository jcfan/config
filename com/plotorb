#!/bin/csh -f
#
# By Peng Fang , SIO, UCSD, Dec. 3, 92
# Modified by Simon Mcclusky Nov. 22 93, June 30 94

#source ~simon/.cshrc                                     
#
echo "   "
echo " PLOTORB is a script for plotting files generated by ORBDIF " 
echo "   "
#
#----------------------------------------------------------
#  prepare headers
#----------------------------------------------------------
set num = $1  
set yn = n

foreach pltf (plt.??)   

if ($yn == "all" ) goto skip 

echo -n " plot" $pltf "? (y/n/all/Ctrl-C=quit) "
set yn = $<
if ($yn == "n" || $yn == "N") goto next  
 
skip:
#----------------------------------------------------------
#  prepare the plot file
#----------------------------------------------------------

set num = `echo $pltf | awk '{print substr($1,5,2)}'`

awk 'NR > 5 {print $1,$2}' $pltf >! tmpx
awk 'NR > 5 {print $1,$3}' $pltf >! tmpy
awk 'NR > 5 {print $1,$4}' $pltf >! tmpz

set ylab1 = `head -n 1 $pltf`
set ylabt = `head -n 1 $pltf | awk ' {print $1}'`
set ylab2 = `head -n 2 $pltf | tail -n -1`
set ylab3 = `head -n 3 $pltf | tail -n -1`
set xlab = `head -n 4 $pltf | tail -n -1`
set xmax = `head -n 5 $pltf | tail -n -1`
set ymax1 = `head -n 6 $pltf | tail -n -1`
set ymax2 = `head -n 7 $pltf | tail -n -1`
set ymax3 = `head -n 8 $pltf | tail -n -1`

set file1 = tmpx
set file2 = tmpy
set file3 = tmpz
set testt = "V-X "

#echo  "testt $testt  "
#echo  "ylabt $ylabt  "

if ( $ylabt == $testt ) then
pstext -Jx1 -R0/1/0/1 -K << eof >! prn$num.ps 
4.7 6.8 20 0.0 1 6 Instantaneous Orbit Velocities for Satellite PRN $num
0 5.5 16 90.0 1 6 $ylab1
0 3.4 16 90.0 1 6 $ylab2
0 1.3 16 90.0 1 6 $ylab3
4.7 -.2 18 0.0 1 6 $xlab
eof 

else 
pstext -Jx1 -R0/1/0/1 -K << eof >! prn$num.ps 
4.7 6.8 20 0.0 1 6  Orbit Positional Differences for Satellite PRN $num
0 5.5 16 90.0 1 6 $ylab1
0 3.4 16 90.0 1 6 $ylab2
0 1.3 16 90.0 1 6 $ylab3
4.7 -.2 18 0.0 1 6 $xlab
eof

endif 
echo " plotting prn$num.ps "
#----------------------------------------------------------
#  set extremes
#----------------------------------------------------------

set xmin = 0
#@ xmax = $xmax + 1
#@ ymax1 = $ymax1 + 1
#@ ymax2 = $ymax2 + 1
#@ ymax3 = $ymax3 + 1 
 
set ymin1 = -$ymax1
set ymax1 = $ymax1 
set ymin2 = -$ymax2
set ymax2 = $ymax2
set ymin3 = -$ymax3
set ymax3 = $ymax3


set xlength = 8.5
set ylength = 1.8


set scal1 = `echo $xmin $xmax $xlength $ymin1 $ymax1 $ylength`
set scal1 = `echo $scal1 | awk '{xscl = $3 / ( $2 - $1); yscl = $6 / ( $5 - $4 ); print "-Jx"xscl"/"yscl}'`

set scal2 = `echo $xmin $xmax $xlength $ymin2 $ymax2 $ylength`
set scal2 = `echo $scal2 | awk '{xscl = $3 / ( $2 - $1); yscl = $6 / ( $5 - $4 ); print "-Jx"xscl"/"yscl}'`

set scal3 = `echo $xmin $xmax $xlength $ymin3 $ymax3 $ylength`
set scal3 = `echo $scal3 | awk '{xscl = $3 / ( $2 - $1); yscl = $6 / ( $5 - $4 ); print "-Jx"xscl"/"yscl}'`


set limi1 = '-R'$xmin/$xmax/$ymin1/$ymax1
set limi2 = '-R'$xmin/$xmax/$ymin2/$ymax2
set limi3 = '-R'$xmin/$xmax/$ymin3/$ymax3

#echo -n "xmax $xmax"
#set ent = $<

if  ( $xmax <= 66 ) then

  if  ( $ymax1 <= 3 ) then
  set framn  = -Ba2f1/a1f0.25::Wesn
  else if  ( $ymax1 <= 10 ) then
  set framn  = -Ba2f1/a2f1::Wesn
  else if ( $ymax1 <= 30 ) then
  set framn  = -Ba2f1/a5f2.5::Wesn
  else if ( $ymax1 <= 70 ) then
  set framn  = -Ba2f1/a20f10::Wesn
  else
  set framn  = -Ba2f1/a50f25::Wesn
  endif
  if  ( $ymax2 <= 3 ) then
  set frame  = -Ba2f1/a1f0.25::WeSn
  else if  ( $ymax2 <= 10 ) then
  set frame  = -Ba2f1/a2f1::WeSn
  else if ( $ymax2 <= 30 ) then
  set frame  = -Ba2f1/a5f2.5::WeSn
  else if ( $ymax2 <= 70 ) then
  set frame  = -Ba2f1/a20f10::WeSn
  else
  set frame  = -Ba2f1/a50f25::WeSn
  endif
  if  ( $ymax3 <= 3 ) then
  set framo  = -Ba2f1/a1f0.25::Wesn
  else if  ( $ymax3 <= 10 ) then
  set framo  = -Ba2f1/a2f1::Wesn
  else if ( $ymax3 <= 30 ) then
  set framo  = -Ba2f1/a5f2.5::Wesn
  else if ( $ymax3 <= 70 ) then
  set framo  = -Ba2f1/a20f10::Wesn
  else
  set framo  = -Ba2f1/a50f25::Wesn
  endif

else if ( $xmax <= 200 ) then 

  if  ( $ymax1 <= 3 ) then
  set framn  = -Ba10f2/a1f0.25::Wesn
  else if  ( $ymax1 <= 10 ) then
  set framn  = -Ba10f2/a2f1::Wesn
  else if ( $ymax1 <= 30 ) then
  set framn  = -Ba10f2/a5f2.5::Wesn
  else if ( $ymax1 <= 70 ) then
  set framn  = -Ba10f2/a20f10::Wesn
  else
  set framn  = -Ba10f2/a50f25::Wesn
  endif
  if  ( $ymax2 <= 3 ) then
  set framo  = -Ba10f2/a1f0.25::Wesn
  else if  ( $ymax2 <= 10 ) then
  set framo  = -Ba10f2/a2f1::Wesn
  else if ( $ymax2 <= 30 ) then
  set framo  = -Ba10f2/a5f2.5::Wesn
  else if ( $ymax2 <= 70 ) then
  set framo  = -Ba10f2/a20f10::Wesn
  else
  set framo  = -Ba10f2/a50f25::Wesn
  endif
  if  ( $ymax3 <= 3 ) then
  set frame  = -Ba10f2/a1f0.25::WeSn
  else if  ( $ymax3 <= 10 ) then
  set frame  = -Ba10f2/a2f1::WeSn
  else if ( $ymax3 <= 30 ) then
  set frame  = -Ba10f2/a5f2.5::WeSn
  else if ( $ymax3 <= 70 ) then
  set frame  = -Ba10f2/a20f10::WeSn
  else
  set frame  = -Ba10f2/a50f25::WeSn
  endif

else   

  if  ( $ymax1 <= 3 ) then
  set framn  = -Ba30f5/a1f0.25::Wesn
  else if  ( $ymax1 <= 10 ) then
  set framn  = -Ba30f5/a2f1::Wesn
  else if ( $ymax1 <= 30 ) then
  set framn  = -Ba30f5/a5f2.5::Wesn
  else if ( $ymax1 <= 70 ) then
  set framn  = -Ba30f5/a20f10::Wesn
  else
  set framn  = -Ba30f5/a50f25::Wesn
  endif
  if  ( $ymax2 <= 3 ) then
  set framo  = -Ba30f5/a1f0.25::Wesn
  else if  ( $ymax2 <= 10 ) then
  set framo  = -Ba30f5/a2f1::Wesn
  else if ( $ymax2 <= 30 ) then
  set framo  = -Ba30f5/a5f2.5::Wesn
  else if ( $ymax2 <= 70 ) then
  set framo  = -Ba30f5/a20f10::Wesn
  else
  set framo  = -Ba30f5/a50f25::Wesn
  endif
  if  ( $ymax3 <= 3 ) then
  set frame  = -Ba30f5/a1f0.25::WeSn
  else if  ( $ymax3 <= 10 ) then
  set frame  = -Ba30f5/a2f1::WeSn
  else if ( $ymax3 <= 30 ) then
  set frame  = -Ba30f5/a5f2.5::WeSn
  else if ( $ymax3 <= 70 ) then
  set frame  = -Ba30f5/a20f10::WeSn
  else
  set frame  = -Ba30f5/a50f25::WeSn
  endif

endif

#----------------------------------------------------------
#  prepare headers
#----------------------------------------------------------

psxy $file1 $framn $limi1 $scal1 -Sb.01 -X0.7 -Y4.60  -O -K >> prn$num.ps
psxy $file2 $framo $limi2 $scal2 -Sb.01       -Y-2.1  -O -K >> prn$num.ps
psxy $file3 $frame $limi3 $scal3 -Sb.01       -Y-2.1  -O    >> prn$num.ps

#----------------------------------------------------------
#  view the plot
#----------------------------------------------------------

# gs prn$num.ps &

next: 

end   

#----------------------------------------------------------
# view and print insrtuctions
#----------------------------------------------------------
echo "  "
echo " To view orbit comparison plots on screen use: " 
echo "  "
echo " gs prn*.ps "
echo "  "
echo " To send orbit comparison plots to printer use: " 
echo "  "
echo " lpr -s prn*.ps "
echo "  "


