#!/bin/csh -f     
# 
#doc Read a SOLVE o-file and set of MODEL z-files and compute zenith wet delay and precipitable water
#
# Written by R. King 28 June 2004
# 

if($#argv < 1) then
more << EOF

 sh_metutil reads a SOLVE o-file and a set of MODEL z-files and computes ZWD and PW using program gamit/utils/metutil

   Usage: sh_metutil -o [o-file] -z [z-files] -s [sigma scale factor]
     
    where  [o-file] is the name of the SOLVE o-file ( o[expt]a.ddd )
           [z-file] gives the list of z-files to be read (wildcards allowed) 
           [sigma scale factor ] is the scaling factor for the o-file zenith delay uncertainties (default 1.0)
 
           
    Examples: sh_metutil  -o oeuraa.223  -z zkosg4.223 
              sh_metutil  -o oeuraa.223  -z z*.223  -s 1.6 


    Output files are named METUTIL.ssss   where ssss is the site name from the z-files

EOF
   
exit
endif
#-----   

# set defaults
set scale = 1.0    
set zfiles = ' '
set ofile = ' ' 
set outfiles = 'METUTIL.outfile'

# get the arguments   
foreach a ($argv)
switch($a)
  case -z:      
    set zfiles  = (`echo $argv | cut -d- -f2`); shift zfiles 
   breaksw
  case -o:
    set ofile = $argv[2]
    breaksw 
  case -s:
    set scale = $argv[2]
    breaksw
endsw 
shift
end                        

# Run the program
echo "Running metutil "  
\rm -f tmp.out
foreach file ( `echo $zfiles` )  
  echo " .. working on"  $file
  metutil $file $ofile $scale >> tmp.out
end 
echo "Finished ... file tmp.out of screen display removed "                     
\rm -f tmp.out                                

exit
